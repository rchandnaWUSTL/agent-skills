{
  "enabled": true,
  "name": "Validate Action Implementation",
  "description": "Validates a Terraform action implementation against quality standards defined in steering doc",
  "version": "3",
  "when": {
    "type": "userTriggered"
  },
  "then": {
    "type": "askAgent",
    "prompt": "Validate a Terraform action implementation against the standards in `.kiro/steering/actions.md`.\n\n**IMPORTANT**: Use `.kiro/steering/actions.md` as the source of truth for all validation criteria, patterns, and examples.\n\n**Step 1: Identify Action**\nAsk the user for:\n1. Action name (e.g., \"aws_ssm_send_command\")\n2. Service name (e.g., \"ssm\")\n\nOr detect from current file if in an action file.\n\n**Step 2: File Existence Check**\nVerify required files exist (see steering doc \"File Structure\" section):\n- [ ] internal/service/<service>/<action>_action.go\n- [ ] internal/service/<service>/<action>_action_test.go\n- [ ] website/docs/actions/<action>.html.markdown\n- [ ] .changelog/<description>.txt\n- [ ] Sweep function in sweep.go (if action creates resources - see steering doc)\n\n**Step 3: Spec Validation (if spec exists)**\nIf `.kiro/specs/<action>-action/` exists, validate against steering doc requirements:\n\n**requirements.md** - Check against \"Requirements Document Structure\" in steering doc:\n- [ ] Has comprehensive glossary (see steering doc for requirements)\n- [ ] User stories follow EARS patterns\n- [ ] Acceptance criteria are INCOSE-compliant\n\n**design.md** - Check against \"Design Document Structure\" in steering doc:\n- [ ] Has all REQUIRED sections listed in steering doc:\n  - Design Decisions and Rationales\n  - Security Considerations\n  - Performance Considerations\n  - Dependencies\n- [ ] Has RECOMMENDED sections:\n  - Mermaid diagrams\n  - Future Enhancements\n  - Schema in table format\n- [ ] All AWS error types documented (see steering doc error handling section)\n\n**tasks.md** - Check against steering doc task guidance:\n- [ ] Includes sweep function task (if needed - see steering doc)\n- [ ] Includes actionwait usage task (if polling - see steering doc)\n- [ ] Includes terrafmt formatting task\n- [ ] Has pre-submission checklist from steering doc\n\n**Step 4: Code Compilation Check**\nRun compilation checks as specified in steering doc:\n```bash\ngo build -o /dev/null .\ngo build -o /dev/null ./internal/service/<service>\ngo test -c -o /dev/null ./internal/service/<service>\n```\n\nReport any compilation errors with file and line numbers.\n\n**Step 5: Schema Validation (CRITICAL)**\nValidate against \"Common Schema Issues\" section in steering doc.\n\nCheck for all issues listed in steering doc:\n- [ ] Model uses fwtypes (NOT types) - see steering doc examples\n- [ ] List/Map have ElementType - see steering doc\n- [ ] Optional with defaults marked Computed - see steering doc\n- [ ] Region uses framework.WithRegionModel - see steering doc\n- [ ] All attributes have descriptions\n- [ ] Validators properly imported\n\nRefer to steering doc \"Schema Validation Checklist\" for complete list.\n\n**Step 6: Implementation Quality Check**\nValidate against \"Key Implementation Requirements\" in steering doc.\n\nCheck all areas covered in steering doc:\n- [ ] Progress Reporting (see steering doc section 1)\n- [ ] Timeout Management (see steering doc section 2)\n- [ ] Error Handling (see steering doc section 3)\n- [ ] AWS SDK Integration (see steering doc section 4)\n- [ ] Parameter Validation (see steering doc section 5)\n- [ ] Polling and Waiting (see steering doc section 6)\n\n**For polling operations**, verify actionwait usage matches steering doc examples:\n- Uses actionwait.WaitForStatus\n- Defines success/transitional states\n- Implements progress sink\n- See steering doc for complete pattern\n\n**Step 7: Test Validation**\nValidate against \"Testing Actions\" section in steering doc.\n\nCheck:\n- [ ] Test structure matches steering doc patterns\n- [ ] Test coverage includes scenarios from steering doc\n- [ ] Sweep function implemented (see steering doc \"Test Cleanup\" section)\n\n**Step 8: Documentation Validation**\nValidate against \"Documentation Standards\" section in steering doc.\n\nCheck all requirements from steering doc:\n- [ ] Front matter complete\n- [ ] Beta/alpha warnings\n- [ ] Multiple examples (basic, advanced, trigger)\n- [ ] Argument reference complete\n- [ ] Prerequisites documented\n- [ ] IAM permissions documented\n- [ ] Terraform code formatted with terrafmt (see steering doc)\n\n**Step 9: Service Package Registration**\nVerify registration (see steering doc \"File Structure\" section):\n- [ ] Actions() method exists in service_package_gen.go\n- [ ] Action registered with correct TypeName\n- [ ] Factory function name matches\n\n**Step 10: Changelog Entry**\nVerify format matches steering doc \"Changelog Entry Format\" section:\n- [ ] Entry exists in .changelog/\n- [ ] Format: ```release-note:new-action\n- [ ] Follows steering doc pattern\n\n**Step 11: Run Linting**\nRun linting checks as specified in steering doc:\n```bash\nmake golangci-lint PKG=<service>\nmake provider-lint\n```\n\nReport any linting errors or warnings with file and line numbers.\n\n**Step 12: Run Tests**\nRun tests as specified in steering doc:\n```bash\n# Compile tests\ngo test -c -o /dev/null ./internal/service/<service>\n\n# Run tests without TF_ACC (should skip)\ngo test ./internal/service/<service> -run TestAcc.*Action_ -v\n\n# If user confirms, run acceptance tests\nTF_ACC=1 go test ./internal/service/<service> -run TestAcc.*Action_ -v -timeout 30m\n```\n\nReport test results:\n- Number of tests run\n- Pass/fail status\n- Any test failures with details\n- Test coverage for action scenarios\n\n**Step 13: Run Diagnostics**\nUse getDiagnostics tool on action and test files.\nReport any compilation errors, type mismatches, or warnings.\n\n**Step 14: Generate Validation Report**\n\nCreate a comprehensive report with:\n\n**Summary:**\n- Action name and service\n- Overall status (Pass/Fail/Warnings)\n- Compilation status (Pass/Fail)\n- Linting status (Pass/Fail/Warnings)\n- Test status (Pass/Fail/Skipped)\n- Critical issues count\n- Warning count\n\n**Critical Issues (Must Fix):**\nList issues that violate steering doc requirements:\n- Compilation errors with file and line numbers\n- Test failures with details\n- Schema type issues (see steering doc \"Common Schema Issues\")\n- Missing ElementType (see steering doc)\n- Missing required files\n- Missing actionwait for polling (see steering doc section 6)\n- Missing sweep function (see steering doc \"Test Cleanup\")\n\n**Warnings (Should Fix):**\nList items that don't meet steering doc recommendations:\n- Linting warnings with file and line numbers\n- Missing optional tests\n- Documentation improvements\n- Missing spec sections (glossary, design decisions, etc.)\n- Missing IAM documentation\n- Missing prerequisites\n\n**Spec Quality (if spec exists):**\nRate against steering doc requirements:\n- [ ] Has comprehensive glossary (steering doc requirement)\n- [ ] Has design decisions with rationales (steering doc requirement)\n- [ ] Has security considerations (steering doc requirement)\n- [ ] Has performance considerations (steering doc requirement)\n- [ ] Has dependencies documented (steering doc requirement)\n- [ ] Has mermaid diagrams (steering doc recommendation)\n- [ ] Has future enhancements (steering doc recommendation)\n\n**Passed Checks:**\nList all checks that passed.\n\n**Recommendations:**\nProvide specific improvements with references to steering doc sections:\n- \"See `.kiro/steering/actions.md` section on [topic] for guidance\"\n- \"Refer to steering doc examples for [pattern]\"\n- \"Follow steering doc checklist for [area]\"\n\n**Reference Examples:**\nSuggest examples from steering doc based on action pattern:\n- Spec: .kiro/specs/aws_dynamodb_create_backup/\n- Code: [pattern-specific example from steering doc]\n- Docs: [pattern-specific example from steering doc]\n\n**Next Steps:**\nProvide prioritized steps with steering doc references:\n\nIf critical issues:\n1. Fix schema issues (see steering doc \"Common Schema Issues\")\n2. Add actionwait if needed (see steering doc section 6)\n3. Add sweep function if needed (see steering doc \"Test Cleanup\")\n4. Run compilation checks\n5. Re-run validation\n\nIf only warnings:\n1. Review steering doc recommendations\n2. Run terrafmt (see steering doc)\n3. Add missing spec sections (see steering doc)\n4. Ready for submission\n\n**Commands to Fix Issues:**\nProvide commands from steering doc:\n```bash\n# See steering doc \"Running Tests\" section for complete commands\nmake fmt\nterrafmt fmt website/docs/actions/<action>.html.markdown\ngo build -o /dev/null .\ngo test -c -o /dev/null ./internal/service/<service>\nTF_ACC=1 go test ./internal/service/<service> -sweep=us-west-2 -v\n```\n\n**IMPORTANT**: For all technical details, patterns, and examples, direct the user to the relevant sections in `.kiro/steering/actions.md`. The steering doc is the authoritative source.\n\nPerform the validation now and provide a detailed report with steering doc references."
  }
}
